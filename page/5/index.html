<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.jk-kj.com","root":"/","images":"/images","scheme":"Pisces","version":"8.0.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>

  <meta name="description" content="直观层">
<meta property="og:type" content="website">
<meta property="og:title" content="简客-记忆">
<meta property="og:url" content="http://www.jk-kj.com/page/5/index.html">
<meta property="og:site_name" content="简客-记忆">
<meta property="og:description" content="直观层">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="hottredpen">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.jk-kj.com/page/5/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>简客-记忆</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">简客-记忆</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">抽象的才是永恒的</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="hottredpen"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">hottredpen</p>
  <div class="site-description" itemprop="description">直观层</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8leftjoin-group%E5%8F%8A%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8leftjoin-group%E5%8F%8A%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">记一次使用leftjoin,group及子查询的配合使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-07-27 15:47:12" itemprop="dateCreated datePublished" datetime="2018-07-27T15:47:12+08:00">2018-07-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-12 20:29:21" itemprop="dateModified" datetime="2020-11-12T20:29:21+08:00">2020-11-12</time>
      </span>

  
    <span id="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8leftjoin-group%E5%8F%8A%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8/" class="post-meta-item leancloud_visitors" data-flag-title="记一次使用leftjoin,group及子查询的配合使用" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>库存数据统计</p>
<p>库存的数量动态的，列出产品的同时，将批次表里的同product_id的cur_num相加，作为该产品的库存</p>
<h3 id="以前的做法"><a href="#以前的做法" class="headerlink" title="以前的做法"></a>以前的做法</h3><p>先将产品列表取出（一条sql）<br>foreach 每个产品，并查询总数（当前页数*1条sql）</p>
<h3 id="改进后的做法"><a href="#改进后的做法" class="headerlink" title="改进后的做法"></a>改进后的做法</h3><p>先用子查询获取查询的总数,然后一下group，group后的字段作为leftjoin的关联字段</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="variable">$storeProductBatchQuery</span> = M(<span class="string">&#x27;store_product_batch as spb&#x27;</span>)-&gt;field(<span class="string">&#x27;SUM(cur_num) as spb_cur_num_count,product_id&#x27;</span>)-&gt;group(<span class="string">&#x27;product_id&#x27;</span>)-&gt;buildSql(); <span class="regexp">//</span> group的使用</span><br><span class="line"><span class="variable">$list</span> = M(<span class="string">&quot;product as p&quot;</span>)</span><br><span class="line">        -&gt;join(<span class="string">&#x27;left join &#x27;</span>.<span class="variable">$storeProductBatchQuery</span>.<span class="string">&#x27; as spb on spb.product_id = p.id&#x27;</span>)</span><br><span class="line">        -&gt;field(<span class="string">&#x27;p.*,spb.spb_cur_num_count&#x27;</span>)</span><br><span class="line">        -&gt;where(<span class="variable">$newmap</span>)</span><br><span class="line">        -&gt;order(<span class="variable">$order</span>)</span><br><span class="line">        -&gt;limit(<span class="variable">$offset</span>.<span class="string">&#x27;,&#x27;</span>.<span class="variable">$page_size</span>)</span><br><span class="line">        -&gt;select(false);</span><br><span class="line"></span><br><span class="line">        dump(<span class="variable">$list</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/%E5%AE%89%E8%A3%85python3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/%E5%AE%89%E8%A3%85python3/" class="post-title-link" itemprop="url">安装python3</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-07-16 13:31:21" itemprop="dateCreated datePublished" datetime="2018-07-16T13:31:21+08:00">2018-07-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-20 11:25:16" itemprop="dateModified" datetime="2020-11-20T11:25:16+08:00">2020-11-20</time>
      </span>

  
    <span id="/%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/%E5%AE%89%E8%A3%85python3/" class="post-meta-item leancloud_visitors" data-flag-title="安装python3" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>安装TensorFlow</p>
<h3 id="安装python3"><a href="#安装python3" class="headerlink" title="安装python3"></a>安装python3</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install python3</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Pip, setuptools, and wheel have been installed. To update them</span><br><span class="line">  pip3 install --upgrade pip setuptools wheel</span><br><span class="line"></span><br><span class="line">You can install Python packages with</span><br><span class="line">  pip3 install &lt;package&gt;</span><br><span class="line"></span><br><span class="line">They will install into the site-package directory</span><br><span class="line">  /usr/<span class="built_in">local</span>/lib/python3.6/site-packages</span><br><span class="line"></span><br><span class="line">See: https://docs.brew.sh/Homebrew-and-Python.html</span><br><span class="line">==&gt; Summary</span><br><span class="line">🍺  /usr/<span class="built_in">local</span>/Cellar/python3/3.6.3: 7,973 files, 111.1MB, built <span class="keyword">in</span> 19 minutes 38 seconds</span><br><span class="line">➜  tensorflow python3 --version</span><br><span class="line">Python 3.6.3</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E4%BD%BF%E7%94%A8%E9%98%BF%E9%87%8C%E4%BA%91%E9%82%AE%E4%BB%B6%E6%8E%A8%E9%80%81%E5%AE%9E%E7%8E%B0SMTP%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E4%BD%BF%E7%94%A8%E9%98%BF%E9%87%8C%E4%BA%91%E9%82%AE%E4%BB%B6%E6%8E%A8%E9%80%81%E5%AE%9E%E7%8E%B0SMTP%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/" class="post-title-link" itemprop="url">使用阿里云邮件推送实现SMTP发送邮件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-28 11:05:35" itemprop="dateCreated datePublished" datetime="2018-03-28T11:05:35+08:00">2018-03-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-12 20:29:21" itemprop="dateModified" datetime="2020-11-12T20:29:21+08:00">2020-11-12</time>
      </span>

  
    <span id="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E4%BD%BF%E7%94%A8%E9%98%BF%E9%87%8C%E4%BA%91%E9%82%AE%E4%BB%B6%E6%8E%A8%E9%80%81%E5%AE%9E%E7%8E%B0SMTP%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/" class="post-meta-item leancloud_visitors" data-flag-title="使用阿里云邮件推送实现SMTP发送邮件" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>一个wordpress项目里的自带的邮件（代发）发送邮件不稳定。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>WordPress 使用阿里云邮件推送实现SMTP发送邮件<br><a target="_blank" rel="noopener" href="https://www.wpdaxue.com/wordpress-aliyun-smtp.html">https://www.wpdaxue.com/wordpress-aliyun-smtp.html</a></p>
<h3 id="来自第三方的介绍"><a href="#来自第三方的介绍" class="headerlink" title="来自第三方的介绍"></a>来自第三方的介绍</h3><p>6、切换到“发信地址”界面，新建发信地址：<br>现在很多虚拟主机都是默认不支持 mail() 函数发送邮件的，不过一般都提供 smtp 发件支持。要找一个好用的 smtp 发送邮件方可不容易，不是发件数量限制太小，就是经常被判为垃圾邮件。所以倡萌此前一直在服务器搭建邮件发送功能，并想办法优化提高邮件可行度，避免被判为垃圾邮件，但效果还是不太理想。前些天，想起了阿里云的邮件推送服务，并进行了测试，发现真的不错哦。</p>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>1、要了解和开通阿里云邮件推送服务，请查看：<a target="_blank" rel="noopener" href="https://www.aliyun.com/product/directmail">https://www.aliyun.com/product/directmail</a></p>
<p>2、开通以后，在控制台进入“发信域名”新建域名<br>阿里云里提示最好用二级域名，但是<a href="mailto:&#115;&#x65;&#114;&#x76;&#105;&#99;&#101;&#64;&#x65;&#x6d;&#97;&#105;&#108;&#46;&#x6a;&#x6b;&#45;&#x6b;&#x6a;&#46;&#x63;&#111;&#x6d;">&#115;&#x65;&#114;&#x76;&#105;&#99;&#101;&#64;&#x65;&#x6d;&#97;&#105;&#108;&#46;&#x6a;&#x6b;&#45;&#x6b;&#x6a;&#46;&#x63;&#111;&#x6d;</a>类似的邮箱还是会被某些插件不认可。最后我还是用上了<a href="mailto:&#115;&#101;&#114;&#118;&#x69;&#x63;&#x65;&#x40;&#106;&#x6b;&#45;&#x6b;&#106;&#x2e;&#99;&#111;&#109;">&#115;&#101;&#114;&#118;&#x69;&#x63;&#x65;&#x40;&#106;&#x6b;&#45;&#x6b;&#106;&#x2e;&#99;&#111;&#109;</a><br>3、添加域名后，点击配置，可以查看到域名配置信息<br>4、按照域名配置信息的提示，到你的域名解析后台添加3条解析记录：<br>5、添加完解析记录，回到阿里云后台，点击“验证”，返回“验证通过”说明解析生效：<br>6、切换到“发信地址”界面，新建发信地址：<br>7、选择刚才添加的发信域名，然后输入你要使用的账号，输入回信地址，选择发信类型：批量邮件<br>注：发信类型有：<br>触发邮件：注册确认、订单确认、密码重置、交易通知等<br>批量邮件：自有用户的产品促销、期刊订阅等<br>但是有些用户反馈，触发邮件方式不太稳定，你可以根据自己的实际选择吧，这里我选择的是批量邮件<br>8、添加完返回到界面，点击“验证回信地址”，然后会发送邮件到你的回信地址，到你的邮件箱点击邮件的链接验证通过即可，注意哦，验证邮件可能在垃圾箱里。然后设置SMTP 密码。<br>9、完成上面的步骤后，阿里云的邮件推送的SMTP发送功能就设置好了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E5%AD%A6%E6%97%A0%E6%AD%A2%E5%A2%83/MySql%E6%8C%89%E5%91%A8%EF%BC%8C%E6%8C%89%E6%9C%88%EF%BC%8C%E6%8C%89%E6%97%A5%E5%88%86%E7%BB%84%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%AD%A6%E6%97%A0%E6%AD%A2%E5%A2%83/MySql%E6%8C%89%E5%91%A8%EF%BC%8C%E6%8C%89%E6%9C%88%EF%BC%8C%E6%8C%89%E6%97%A5%E5%88%86%E7%BB%84%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">MySql按周，按月，按日分组统计数据</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-19 14:25:08" itemprop="dateCreated datePublished" datetime="2018-03-19T14:25:08+08:00">2018-03-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-12 20:29:21" itemprop="dateModified" datetime="2020-11-12T20:29:21+08:00">2020-11-12</time>
      </span>

  
    <span id="/%E5%AD%A6%E6%97%A0%E6%AD%A2%E5%A2%83/MySql%E6%8C%89%E5%91%A8%EF%BC%8C%E6%8C%89%E6%9C%88%EF%BC%8C%E6%8C%89%E6%97%A5%E5%88%86%E7%BB%84%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE/" class="post-meta-item leancloud_visitors" data-flag-title="MySql按周，按月，按日分组统计数据" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>之前开发微信时，做过类似的简单统计。那时对于mysql的理解比较浅，有些数据都是预先存入数据去实现的。这时就会出现多个时间，比如create_time  create_date。<br>现在开发开单宝的统计，特意搜索了一下关于统计时mysql处理的文章</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>MySql按周，按月，按日分组统计数据<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/lqclh502/article/details/50157483">https://blog.csdn.net/lqclh502/article/details/50157483</a><br>MySQL中distinct和count(*)的使用方法比较<br><a target="_blank" rel="noopener" href="http://www.jb51.net/article/74559.htm">http://www.jb51.net/article/74559.htm</a></p>
<h3 id="几个关键词"><a href="#几个关键词" class="headerlink" title="几个关键词"></a>几个关键词</h3><h4 id="网上的资料"><a href="#网上的资料" class="headerlink" title="网上的资料"></a>网上的资料</h4><p>关键词：<code>DATE_FORMAT</code><br>对时间进行格式化<br>例子：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select DATE_FORMAT(create_time,<span class="string">&#x27;%Y%u&#x27;</span>) weeks,count(caseid) count <span class="keyword">from</span> tc_case<span class="built_in"> group </span>by weeks;</span><br><span class="line"></span><br><span class="line">select DATE_FORMAT(create_time,<span class="string">&#x27;%Y%m%d&#x27;</span>) days,count(caseid) count <span class="keyword">from</span> tc_case<span class="built_in"> group </span>by days;</span><br><span class="line"></span><br><span class="line">select DATE_FORMAT(create_time,<span class="string">&#x27;%Y%m&#x27;</span>) months,count(caseid) count <span class="keyword">from</span> tc_case<span class="built_in"> group </span>by months;</span><br></pre></td></tr></table></figure>

<p>DATE_FORMAT(date,format)</p>
<p>根据format字符串格式化date值。下列修饰符可以被用在format字符串中：</p>
<p>%M 月名字(January……December)<br>%W 星期名字(Sunday……Saturday)<br>%D 有英语前缀的月份的日期(1st, 2nd, 3rd, 等等。）<br>%Y 年, 数字, 4 位<br>%y 年, 数字, 2 位<br>%a 缩写的星期名字(Sun……Sat)<br>%d 月份中的天数, 数字(00……31)<br>%e 月份中的天数, 数字(0……31)<br>%m 月, 数字(01……12)<br>%c 月, 数字(1……12)<br>%b 缩写的月份名字(Jan……Dec)<br>%j 一年中的天数(001……366)<br>%H 小时(00……23)<br>%k 小时(0……23)<br>%h 小时(01……12)<br>%I 小时(01……12)<br>%l 小时(1……12)<br>%i 分钟, 数字(00……59)<br>%r 时间,12 小时(hh:mm:ss [AP]M)<br>%T 时间,24 小时(hh:mm:ss)<br>%S 秒(00……59)<br>%s 秒(00……59)<br>%p AM或PM<br>%w 一个星期中的天数(0=Sunday ……6=Saturday ）<br>%U 星期(0……52), 这里星期天是星期的第一天<br>%u 星期(0……52), 这里星期一是星期的第一天<br>%% 一个文字“%”</p>
<h4 id="动手实战"><a href="#动手实战" class="headerlink" title="动手实战"></a>动手实战</h4><p>网上写的是DATE类型的字段的处理，可是我习惯用int类型的时间戳保存时间<br>需要改进一下</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DATE_FORMAT( <span class="name">FROM_UNIXTIME</span>(<span class="name">create_time</span>),&#x27;%Y-%m-%d&#x27; ) AS  days</span><br><span class="line">DATE_FORMAT( <span class="name">FROM_UNIXTIME</span>(<span class="name">create_time</span>),&#x27;%Y-%m&#x27; ) AS  months</span><br><span class="line">DATE_FORMAT( <span class="name">FROM_UNIXTIME</span>(<span class="name">create_time</span>),&#x27;%u&#x27; ) AS  weeks</span><br></pre></td></tr></table></figure>

<p>接下来只要对 days months weeks进group就OK<br>thinkphp下的代码</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">list</span> = M(<span class="string">&quot;Order&quot;</span>)</span><br><span class="line"><span class="function">        -&gt;</span>field(<span class="string">&quot; DATE_FORMAT( FROM_UNIXTIME(create_time),&#x27;%Y-%m-%d&#x27; ) AS  days, SUM(total_money) total_money_count , COUNT( DISTINCT customer_id ) AS customer_id_count , COUNT( id ) AS order_count&quot;</span>)</span><br><span class="line"><span class="function">        -&gt;</span>where($newmap)</span><br><span class="line"><span class="function">        -&gt;</span>group(<span class="string">&#x27; days &#x27;</span>)</span><br><span class="line"><span class="function">        -&gt;</span>select();</span><br></pre></td></tr></table></figure>

<p>关键词：<code>DISTINCT</code><br>在count不重复的记录的时候就能用到它，<br>上面的代码里就用到了<code>COUNT( DISTINCT customer_id ) AS customer_id_count</code>,有了这个关键词，就不用以前的笨方法了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%AE%B0%E4%B8%80%E6%AC%A1php%E5%AE%89%E8%A3%85ImageMagick%E6%89%A9%E5%B1%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%AE%B0%E4%B8%80%E6%AC%A1php%E5%AE%89%E8%A3%85ImageMagick%E6%89%A9%E5%B1%95/" class="post-title-link" itemprop="url">记一次php安装ImageMagick扩展</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-19 14:01:27" itemprop="dateCreated datePublished" datetime="2018-03-19T14:01:27+08:00">2018-03-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-12 20:29:21" itemprop="dateModified" datetime="2020-11-12T20:29:21+08:00">2020-11-12</time>
      </span>

  
    <span id="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%AE%B0%E4%B8%80%E6%AC%A1php%E5%AE%89%E8%A3%85ImageMagick%E6%89%A9%E5%B1%95/" class="post-meta-item leancloud_visitors" data-flag-title="记一次php安装ImageMagick扩展" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>将pdf转png图片</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>在wamp server环境下安装php_imagick拓展<br><a target="_blank" rel="noopener" href="http://www.smallerpig.com/673.html">http://www.smallerpig.com/673.html</a><br>windows php安装ImageMagick扩展<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/livelinux/article/details/50319853">http://blog.csdn.net/livelinux/article/details/50319853</a><br>Centos 安装ImageMagick 与 imagick for php步骤详解<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xingmeng/p/4268043.html#undefined">https://www.cnblogs.com/xingmeng/p/4268043.html#undefined</a></p>
<h3 id="本机wamp下安装php-imagick拓展"><a href="#本机wamp下安装php-imagick拓展" class="headerlink" title="本机wamp下安装php_imagick拓展"></a>本机wamp下安装php_imagick拓展</h3><h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><p>1.在php安装目录的ext文件夹下新建imagick文件夹<br>2.将该文件夹的路径添加到系统路径(path值).<br>3.从网址<a target="_blank" rel="noopener" href="http://windows.php.net/downloads/pecl/releases/imagick/%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94php%E7%89%88%E6%9C%AC%E7%9A%84imagick">http://windows.php.net/downloads/pecl/releases/imagick/下载对应php版本的imagick</a>(phpinfo中看php version,Compiler ，Architecture，这三个属性)<br>4.这里需要注意的是下载的文件区别,我们从文件名中来区分,例如php_imagick-3.2.0b2-5.5-nts-vc11-x86.zip</p>
<pre><code>其中5.5是对应的php版本.
nts值代表该文件适用于IIS,ts代表该文件适用于Apache,
VC11和VC9是编译器的版本.我们可以适用phpinfo()命令来查看我们机器上php适用的是哪个版本(如图1)
x86代表适用32位系统,x64代表适用64位系统</code></pre>
<p>5.下载好对应的zip文件后,将所有文件解压到我们第一步新建的imagick文件夹!</p>
<p>6.添加php_imagick.dll的完整路径到php.ini文件中.例如:extension=C:\wamp\bin\php\php5.5.12\ext\ext\imagick\php_imagick.dll</p>
<p>7.重启wamp服务器</p>
<p>8.运行phpinfo看看是不是已经成功添加拓展了</p>
<p>9.查看phpinfo中，查看ImageMagick supported formats内的值</p>
<p>输入phpinfo()看到imagick，就算装成功了，但这个时候还不能用，你会看到ImageMagick number of supported formats 为0，ImageMagick supported formats no value，还要安装ImageMagick ，phpinfo里面会写出要安装那个版本的，如：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ImageMagick</span> <span class="number">6</span>.<span class="number">9</span>.<span class="number">3</span>-<span class="number">7</span> Q<span class="number">16</span> x<span class="number">64</span> <span class="number">2016</span>-<span class="number">03</span>-<span class="number">27</span> http://www.imagemagick.org </span><br></pre></td></tr></table></figure>

<p>然后去下载这个ImageMagick 6.9.3-7 Q16 x64 版本的安装</p>
<p>记得版本要对得上号，要不然就会出现ImageMagick supported formats no value</p>
<p>安装完后重启，再输入phpinfo,就会看到ImageMagick supported formats不是空的了，这个时候就算安全成功</p>
<h3 id="Centos-安装ImageMagick"><a href="#Centos-安装ImageMagick" class="headerlink" title="Centos 安装ImageMagick"></a>Centos 安装ImageMagick</h3><h4 id="1-依次运行以下命令"><a href="#1-依次运行以下命令" class="headerlink" title="1. 依次运行以下命令"></a>1. 依次运行以下命令</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> ImageMagick</span><br><span class="line"></span><br><span class="line">yum <span class="keyword">install</span> ImageMagick-devel</span><br><span class="line"></span><br><span class="line">yum <span class="keyword">install</span> php-pear [for PECL]</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> php-devel</span><br></pre></td></tr></table></figure>

<h4 id="2-安装C编译器"><a href="#2-安装C编译器" class="headerlink" title="2. 安装C编译器"></a>2. 安装C编译器</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> gcc</span><br></pre></td></tr></table></figure>
<p>如果装不了gcc就用这个命令：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc gcc-c++ <span class="built_in">auto</span>conf <span class="built_in">auto</span>make</span><br></pre></td></tr></table></figure>

<h4 id="3-安装imagick"><a href="#3-安装imagick" class="headerlink" title="3. 安装imagick"></a>3. 安装imagick</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pecl <span class="keyword">install</span> imagick</span><br></pre></td></tr></table></figure>

<h4 id="4-加载imagick到php"><a href="#4-加载imagick到php" class="headerlink" title="4. 加载imagick到php"></a>4. 加载imagick到php</h4><p>在/etc/php.ini 加上extension=imagick.so</p>
<h4 id="5-重启service-httpd-restart"><a href="#5-重启service-httpd-restart" class="headerlink" title="5. 重启service httpd restart"></a>5. 重启service httpd restart</h4><h4 id="6-使用-phpinfo-或运行-php-m-grep-imagick-来查看是否安装成功"><a href="#6-使用-phpinfo-或运行-php-m-grep-imagick-来查看是否安装成功" class="headerlink" title="6. 使用 phpinfo() 或运行 php -m | grep imagick 来查看是否安装成功"></a>6. 使用 phpinfo() 或运行 php -m | grep imagick 来查看是否安装成功</h4><h3 id="mac-上安装"><a href="#mac-上安装" class="headerlink" title="mac 上安装"></a>mac 上安装</h3><h4 id="安装php的imagick拓展"><a href="#安装php的imagick拓展" class="headerlink" title="安装php的imagick拓展"></a>安装php的imagick拓展</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew reinstall php56-imagick --build-<span class="keyword">from</span>-<span class="keyword">source</span></span><br></pre></td></tr></table></figure>

<h4 id="安装ghostscript"><a href="#安装ghostscript" class="headerlink" title="安装ghostscript"></a>安装ghostscript</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>ghostscript</span><br></pre></td></tr></table></figure>

<h3 id="linux上安装"><a href="#linux上安装" class="headerlink" title="linux上安装"></a>linux上安装</h3><p>这次被坑惨了，linux是最近新的服务器里面没有安装过GD库，这个导致我后面多个坑</p>
<p>第一次安装走的是<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xingmeng/p/4268043.html#undefined">https://www.cnblogs.com/xingmeng/p/4268043.html#undefined</a><br>里面的方法，</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> ImageMagick</span><br><span class="line">yum <span class="keyword">install</span> ImageMagick-devel</span><br><span class="line">yum <span class="keyword">install</span> php-pear</span><br><span class="line">yum -y <span class="keyword">install</span> php-devel</span><br><span class="line">yum <span class="keyword">install</span> gcc</span><br><span class="line">yum <span class="keyword">install</span> gcc gcc-c++ autoconf automake</span><br><span class="line">pecl <span class="keyword">install</span> imagick</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>加载imagick到php<br>在/etc/php.ini 加上extension=imagick.so</p>
<p>重启service httpd restart</p>
<p>使用 phpinfo() 或运行 php -m | grep imagick 来查看是否安装成功</p>
<p>这次</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Imagick,</span> ImagickDraw, ImagickPixel, ImagickPixelIterator,(ImagickKernel  不知道为什么没有这个，本机和mac上都有)  </span><br></pre></td></tr></table></figure>

<p>结果提示错误，具体忘记了，估计是因为GD库没有引起的<br>之后照着<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/snow_small/article/details/79173575">http://blog.csdn.net/snow_small/article/details/79173575</a><br>进行了编译安装<br>1、安装ImageMagic</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> download]<span class="meta"># wget http://www.imagemagick.org/download/ImageMagick.tar.gz  </span></span><br><span class="line"></span><br><span class="line">[root<span class="symbol">@localhost</span> download]<span class="meta"># tar -xzvf ImageMagick  </span></span><br><span class="line">[root<span class="symbol">@localhost</span> download]<span class="meta"># cd ImageMagick-7.0.7-22/  </span></span><br><span class="line">[root<span class="symbol">@localhost</span> ImageMagick<span class="number">-7.0</span><span class="number">.7</span><span class="number">-22</span>]<span class="meta"># ./configure --prefix=/usr/local/imagemagick  </span></span><br><span class="line">[root<span class="symbol">@localhost</span> ImageMagick<span class="number">-7.0</span><span class="number">.7</span><span class="number">-22</span>]<span class="meta"># make  </span></span><br><span class="line">[root<span class="symbol">@localhost</span> ImageMagick<span class="number">-7.0</span><span class="number">.7</span><span class="number">-22</span>]<span class="meta"># make install </span></span><br></pre></td></tr></table></figure>

<p>2、检查是否安装成功</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@localhost ImageMagick-7.0.7-22]</span># /usr/local/imagemagick/bin/convert -version  </span><br><span class="line">Version: ImageMagick <span class="number">7.0</span><span class="number">.7</span><span class="number">-22</span> Q16 x86_64 <span class="number">2018</span><span class="number">-01</span><span class="number">-26</span> http:<span class="comment">//www.imagemagick.org  </span></span><br><span class="line">Copyright: © <span class="number">1999</span><span class="number">-2018</span> ImageMagick Studio LLC  </span><br><span class="line">License: http:<span class="comment">//www.imagemagick.org/script/license.php  </span></span><br><span class="line">Features: Cipher DPC HDRI OpenMP   </span><br><span class="line">Delegates (built-<span class="keyword">in</span>): fontconfig freetype jng jpeg png x xml zlib  </span><br></pre></td></tr></table></figure>


<h3 id="我的坑"><a href="#我的坑" class="headerlink" title="我的坑"></a>我的坑</h3><p>但是报下面这个错误</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Postscript <span class="keyword">delegate</span> failed</span><br></pre></td></tr></table></figure>
<p>是<code>ghostscript</code>没安装，可实际是安装的在<code>/usr/bin/gs</code>中，但apache死活说找不到（是权限问题），网上有个解决方案是把’/usr/local/bin/gs’做软连接到<code>/usr/bin/gs</code>,可是我这边的情况刚好是倒过来的。</p>
<p>一狠心把<code>ghostscript</code>给卸载了，重新编译安装了gs，这次真出现在了<code>/usr/local/bin/gs</code>,建立了个软连接，真把这个问题解决了。</p>
<p>这次因为没有安装GD库，用的png版本太老，<code>Delegates (built-in): fontconfig freetype jng jpeg (png 没显示) x xml zlib  </code></p>
<p>一直提示<br><code>no decode delegate for this image format PNG</code><br>因为没有安装GD库，我在编译<code>ImageMagick-7.0.7-22</code>时没有将<code>png</code>编译进行</p>
<p>直到手动添加了png库，才最终发现没有安装GD库</p>
<p>我们在Centos安装ImageMagick教程中讲述了如何安装ImageMagick,安装完毕之后发现程序并不支持png和jpeg格式的图片,但是这两种图片又是我们平时所常见的,所以我们还要进一步地配置,是其支持png和jpeg格式.</p>
<p>首先我们安装所需的库文件.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> tcl-devel libpng-devel libjpeg-devel ghostscript-devel</span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E9%9A%8F%E7%AC%94/%E7%88%B7%E7%88%B7%E8%B5%B0%E5%A5%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E9%9A%8F%E7%AC%94/%E7%88%B7%E7%88%B7%E8%B5%B0%E5%A5%BD/" class="post-title-link" itemprop="url">爷爷走好</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-06 08:43:13" itemprop="dateCreated datePublished" datetime="2018-02-06T08:43:13+08:00">2018-02-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-12 20:29:21" itemprop="dateModified" datetime="2020-11-12T20:29:21+08:00">2020-11-12</time>
      </span>

  
    <span id="/%E9%9A%8F%E7%AC%94/%E7%88%B7%E7%88%B7%E8%B5%B0%E5%A5%BD/" class="post-meta-item leancloud_visitors" data-flag-title="爷爷走好" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>您的教诲,您的事迹,您的荣誉…不会消逝，一直在我们的心里</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/brew%E5%AE%89%E8%A3%85mongodb%E5%8F%8Aphp-mongodb%E6%89%A9%E5%B1%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/brew%E5%AE%89%E8%A3%85mongodb%E5%8F%8Aphp-mongodb%E6%89%A9%E5%B1%95/" class="post-title-link" itemprop="url">brew安装mongodb及php mongodb扩展</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-01-25 12:59:34" itemprop="dateCreated datePublished" datetime="2018-01-25T12:59:34+08:00">2018-01-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-12 20:29:21" itemprop="dateModified" datetime="2020-11-12T20:29:21+08:00">2020-11-12</time>
      </span>

  
    <span id="/%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/brew%E5%AE%89%E8%A3%85mongodb%E5%8F%8Aphp-mongodb%E6%89%A9%E5%B1%95/" class="post-meta-item leancloud_visitors" data-flag-title="brew安装mongodb及php mongodb扩展" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>安装某laravel项目</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="http://old.ruesin.com/system/mac/mac-mongodb-345.html">http://old.ruesin.com/system/mac/mac-mongodb-345.html</a></p>
<h3 id="安装mongodb服务"><a href="#安装mongodb服务" class="headerlink" title="安装mongodb服务"></a>安装mongodb服务</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>mongodb</span><br></pre></td></tr></table></figure>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">=<span class="function">=&gt;</span> Installing mongodb</span><br><span class="line">=<span class="function">=&gt;</span> Downloading https://homebrew.bintray.com/bottles/mongodb<span class="number">-3.4</span><span class="number">.10</span>.high_sierra.</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span> <span class="number">100.0</span>%</span><br><span class="line">=<span class="function">=&gt;</span> Pouring mongodb<span class="number">-3.4</span><span class="number">.10</span>.high_sierra.bottle.tar.gz</span><br><span class="line">=<span class="function">=&gt;</span> Caveats</span><br><span class="line">To have launchd start mongodb now <span class="keyword">and</span> restart at login:</span><br><span class="line">  brew services start mongodb</span><br><span class="line">Or, <span class="keyword">if</span> you don<span class="string">&#x27;t want/need a background service you can just run:</span></span><br><span class="line"><span class="string">  mongod --config /usr/local/etc/mongod.conf</span></span><br><span class="line"><span class="string">==&gt; Summary</span></span><br></pre></td></tr></table></figure>

<h3 id="php-的-mongodb-扩展"><a href="#php-的-mongodb-扩展" class="headerlink" title="php 的 mongodb 扩展"></a>php 的 mongodb 扩展</h3><p>search一下</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">brew search mongo</span></span><br></pre></td></tr></table></figure>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>php71-mongo</span><br></pre></td></tr></table></figure>

<h4 id="安装出错"><a href="#安装出错" class="headerlink" title="安装出错"></a>安装出错</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">NOTICE: PHP message: PHP Warning:  PHP Startup: mongodb: Unable to initialize module</span><br><span class="line">Module compiled <span class="keyword">with</span> <span class="keyword">build</span> <span class="keyword">ID</span>=API20160303,NTS</span><br><span class="line">PHP    <span class="keyword">compiled</span> <span class="keyword">with</span> <span class="keyword">build</span> <span class="keyword">ID</span>=API20160303,NTS,debug</span><br><span class="line">These options need <span class="keyword">to</span> <span class="keyword">match</span></span><br><span class="line"> <span class="keyword">in</span> <span class="literal">Unknown</span> <span class="keyword">on</span> line <span class="number">0</span></span><br><span class="line">&lt;br /&gt;</span><br><span class="line">&lt;b&gt;<span class="keyword">Warning</span>&lt;/b&gt;:  PHP <span class="keyword">Startup</span>: mongodb: Unable <span class="keyword">to</span> initialize <span class="keyword">module</span></span><br><span class="line"><span class="keyword">Module</span> <span class="keyword">compiled</span> <span class="keyword">with</span> <span class="keyword">build</span> <span class="keyword">ID</span>=API20160303,NTS</span><br><span class="line">PHP    <span class="keyword">compiled</span> <span class="keyword">with</span> <span class="keyword">build</span> <span class="keyword">ID</span>=API20160303,NTS,debug</span><br><span class="line">These options need <span class="keyword">to</span> <span class="keyword">match</span></span><br><span class="line"> <span class="keyword">in</span> &lt;b&gt;<span class="literal">Unknown</span>&lt;/b&gt; <span class="keyword">on</span> line &lt;b&gt;<span class="number">0</span>&lt;/b&gt;&lt;br /&gt;</span><br><span class="line"><span class="literal">Unknown</span>(<span class="number">0</span>) : <span class="keyword">Warning</span> - PHP <span class="keyword">Startup</span>: mongodb: Unable <span class="keyword">to</span> initialize <span class="keyword">module</span></span><br><span class="line"><span class="keyword">Module</span> <span class="keyword">compiled</span> <span class="keyword">with</span> <span class="keyword">build</span> <span class="keyword">ID</span>=API20160303,NTS</span><br><span class="line">PHP    <span class="keyword">compiled</span> <span class="keyword">with</span> <span class="keyword">build</span> <span class="keyword">ID</span>=API20160303,NTS,debug</span><br><span class="line">These options need <span class="keyword">to</span> <span class="keyword">match</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>网上搜是需要重新安装编译</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew reinstall &lt;formulaname&gt; --build-<span class="keyword">from</span>-<span class="keyword">source</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%A7%A3%E5%86%B3%E4%BD%BF%E7%94%A8JWT%E6%97%B6%E6%8A%A5Cannot-handle-token-prior-to%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%A7%A3%E5%86%B3%E4%BD%BF%E7%94%A8JWT%E6%97%B6%E6%8A%A5Cannot-handle-token-prior-to%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">解决使用JWT时报Cannot handle token prior to的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-01-12 13:28:56" itemprop="dateCreated datePublished" datetime="2018-01-12T13:28:56+08:00">2018-01-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-12 20:29:21" itemprop="dateModified" datetime="2020-11-12T20:29:21+08:00">2020-11-12</time>
      </span>

  
    <span id="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%A7%A3%E5%86%B3%E4%BD%BF%E7%94%A8JWT%E6%97%B6%E6%8A%A5Cannot-handle-token-prior-to%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-meta-item leancloud_visitors" data-flag-title="解决使用JWT时报Cannot handle token prior to的问题" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>使用JWT时，因为本地时间和服务器上的时间不一致，导致的请求发送失败</p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p>在<code>vendor\firebase\php-jwt\src\JWT.php</code>中的第113行左右添加如下的代码</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">&#x27;&lt;br /&gt; payload-&gt;iat = &#x27;</span>. <span class="variable">$payload</span>-&gt;iat . <span class="string">&#x27;&lt;br /&gt;and time() = &#x27;</span>.time() . <span class="string">&quot;&lt;br /&gt;leeway= &quot;</span>. <span class="keyword">self</span>::<span class="variable">$leeway</span>;</span><br></pre></td></tr></table></figure>
<p>会打印出</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload-&gt;iat = <span class="number">1447702275</span>  </span><br><span class="line"><span class="keyword">and</span> time() = <span class="number">1447702211</span>  </span><br><span class="line">leeway= <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>通过时间差计算出和服务器的差值，并调整本地的时间</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E5%AD%A6%E6%97%A0%E6%AD%A2%E5%A2%83/%E5%A6%82%E4%BD%95%E6%8F%90%E5%8F%96%E8%B0%B7%E6%AD%8Cchrome%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84crx%E6%8F%92%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%AD%A6%E6%97%A0%E6%AD%A2%E5%A2%83/%E5%A6%82%E4%BD%95%E6%8F%90%E5%8F%96%E8%B0%B7%E6%AD%8Cchrome%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84crx%E6%8F%92%E4%BB%B6/" class="post-title-link" itemprop="url">如何提取谷歌chrome浏览器的crx插件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-01-12 09:29:21" itemprop="dateCreated datePublished" datetime="2018-01-12T09:29:21+08:00">2018-01-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-12 20:29:21" itemprop="dateModified" datetime="2020-11-12T20:29:21+08:00">2020-11-12</time>
      </span>

  
    <span id="/%E5%AD%A6%E6%97%A0%E6%AD%A2%E5%A2%83/%E5%A6%82%E4%BD%95%E6%8F%90%E5%8F%96%E8%B0%B7%E6%AD%8Cchrome%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84crx%E6%8F%92%E4%BB%B6/" class="post-meta-item leancloud_visitors" data-flag-title="如何提取谷歌chrome浏览器的crx插件" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>自己有翻墙工具，而其他人没有，无法获取到插件</p>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><pre><code>访问Chrome扩展商店

搜索需要提取的扩展

点击进入扩展详情

复制地址栏连接

打开chrome-extension-downloader.com

粘贴地址

点击下载即可</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.jk-kj.com/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E4%B8%8A%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E8%BD%AC%E7%A7%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="hottredpen">
      <meta itemprop="description" content="直观层">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="简客-记忆">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E4%B8%8A%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E8%BD%AC%E7%A7%BB/" class="post-title-link" itemprop="url">记一次linux上大文件的转移</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-13 12:43:08" itemprop="dateCreated datePublished" datetime="2017-12-13T12:43:08+08:00">2017-12-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-11-12 20:29:21" itemprop="dateModified" datetime="2020-11-12T20:29:21+08:00">2020-11-12</time>
      </span>

  
    <span id="/%E8%B7%B3%E5%9D%91%E8%AE%B0%E5%BD%95/%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E4%B8%8A%E5%A4%A7%E6%96%87%E4%BB%B6%E7%9A%84%E8%BD%AC%E7%A7%BB/" class="post-meta-item leancloud_visitors" data-flag-title="记一次linux上大文件的转移" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>服务器的内容转到另一台服务器</p>
<h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><h4 id="首先进行了打包"><a href="#首先进行了打包" class="headerlink" title="首先进行了打包"></a>首先进行了打包</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tar</span> -cvf ./kod.tar ./kod<span class="number">3</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>打完包，发现有3个多G<br>就尝试打包压缩</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zcvf ./kod<span class="number">2</span>.tar.gz ./kod<span class="number">3</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>结果还是3G多，只压缩了200M</p>
<h4 id="进行传输"><a href="#进行传输" class="headerlink" title="进行传输"></a>进行传输</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ./kod.tar <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.60</span><span class="number">.168</span>:/tmp</span><br></pre></td></tr></table></figure>

<p>开始有5M/s的速度，可慢慢地变得只有800K/s<br>最气人的是在60%时的时候居然出现了<code>stalled</code></p>
<h4 id="排查问题"><a href="#排查问题" class="headerlink" title="排查问题"></a>排查问题</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">When transferring large files(for example mksysb images) using scp through a firewall, the scp connection stalls.</span><br><span class="line"><span class="attribute">Cause:</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">The reason for scp to stall, is because scp greedily grabs as much bandwith of the network as possible when it transfers files, any delay caused by the network switch of the firewall can easily make the TCP connection stalled.</span><br><span class="line"><span class="attribute">Solution:</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line">There’s a solution to this problem: Add “-l 8192″ to the scp command.</span><br><span class="line"></span><br><span class="line">Adding the option “-l 8192″ limits the scp session bandwith up to 8192 Kbit/second, which seems to work safe and fast enough (up to 1 MB/second):</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h4><p>在原有的命令行上加上了<code>-l 8192</code>可以维持在1M/s</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -l <span class="number">8192</span> ./kod.tar <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.60</span><span class="number">.168</span>:/tmp</span><br></pre></td></tr></table></figure>

<p>开始速度也有6M/s，后面速度一直维持在1M/s，中间无<code>stalled</code></p>
<p>如果是<code>-l 16000</code>则维持在2M/s，以此类推</p>
<h4 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-xvf</span> <span class="selector-tag">kod</span><span class="selector-class">.tar</span></span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-zxvf</span> <span class="selector-tag">kod</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure>


<h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><p>因为转移的文件有很多，而且都很大，我们不可能一直开者等待它传完，这就需要后台运行</p>
<p>先输入密码进行传输<br>然后用<code>ctrl+z</code>,将当前进程挂起到后台暂停运行，执行一些别的操作<br>然后用 <code>bg</code> 来将挂起的进程放在后台(也可以用 <code>fg</code> 来将挂起的进程重新放回前台)继续运行</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[root@pvcent107 build]</span># scp -l <span class="number">8192</span> ./kod.tar <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.60</span><span class="number">.168</span>:/tmp</span><br><span class="line">---------ctrl+zx</span><br><span class="line"><span class="string">[1]</span>+  Stopped                 scp -l <span class="number">8192</span> ./kod.tar <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.60</span><span class="number">.168</span>:/tmp</span><br><span class="line"><span class="string">[root@pvcent107 build]</span># bg %<span class="number">1</span></span><br><span class="line"><span class="string">[1]</span>+ scp -l <span class="number">8192</span> ./kod.tar <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.60</span><span class="number">.168</span>:/tmp &amp;</span><br><span class="line"><span class="string">[root@pvcent107 build]</span># jobs</span><br><span class="line"><span class="string">[1]</span>+  Running                 scp -l <span class="number">8192</span> ./kod.tar <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.60</span><span class="number">.168</span>:/tmp &amp;</span><br><span class="line"><span class="string">[root@pvcent107 build]</span># disown -h %<span class="number">1</span></span><br><span class="line"><span class="string">[root@pvcent107 build]</span># ps -ef |grep kod</span><br><span class="line">root      <span class="number">5790</span>  <span class="number">5577</span>  <span class="number">1</span> <span class="number">10</span>:<span class="number">04</span> pts/<span class="number">3</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> scp -l <span class="number">8192</span> ./kod.tar <span class="symbol">root@</span><span class="number">192.168</span><span class="number">.60</span><span class="number">.168</span>:/tmp</span><br><span class="line">root      <span class="number">5824</span>  <span class="number">5577</span>  <span class="number">0</span> <span class="number">10</span>:<span class="number">05</span> pts/<span class="number">3</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep kod</span><br></pre></td></tr></table></figure>

<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>有时jobs会有多个，注意自己的文件大小是否正常，我就别坑了1次，没传输完成（完成了一个jobs），以为完成了就进行解压缩了。</p>
<h4 id="400G个文件打包"><a href="#400G个文件打包" class="headerlink" title="400G个文件打包"></a>400G个文件打包</h4><p>之前想着。。。400G的文件需要切分-，-！可是用了切分时，却始终没有获取完整的包，好几次我都相信我的总包才80G</p>
<p>最后用了整包打包</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup tar -cjf kod.tar.bz2 ./kod &gt;/dev/<span class="literal">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br></pre></td></tr></table></figure>
<p>打完包发现才有400G+…….我的天，整整打包了一天一夜</p>
<h4 id="400G的传输"><a href="#400G的传输" class="headerlink" title="400G的传输"></a>400G的传输</h4><p>scp 已经无法满足，因为万一中间来个服务器重启，或者其他因素那over了，那流量可就白白流失了<br>最后采用了<code>rsync</code></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -P --rsh=ssh ./kod_all.tar.bz2 <span class="number">112.13</span><span class="number">.14</span><span class="number">.156</span>:/data/ </span><br></pre></td></tr></table></figure>
<p>然后输入密码<br>再ctrl+z 暂停<br>再bg %1  放入后台（假设当前后台允许索引为1）<br>然后用jobs查看<br>如果你当前退出过当前终端，jobs已经无法查看到后台运行的进程，只能用ps</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ps</span> -ef |<span class="keyword">grep</span> kod</span><br></pre></td></tr></table></figure>
<p>会有如下的显示</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root     <span class="number">175100</span> <span class="number">174758</span> <span class="number">47</span> <span class="number">08</span>:<span class="number">10</span> pts/<span class="number">2</span>    <span class="number">00</span>:<span class="number">15</span>:<span class="number">13</span> rsync -P --rsh=ssh ./kod_all.tar.bz2 <span class="number">112.13</span><span class="number">.91</span><span class="number">.176</span>:/data/</span><br><span class="line">root     <span class="number">183245</span> <span class="number">174758</span>  <span class="number">0</span> <span class="number">08</span>:<span class="number">42</span> pts/<span class="number">2</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep --color=<span class="built_in">auto</span> kod</span><br></pre></td></tr></table></figure>

<p>其中<code>00:15:13</code>指本次断点续传进行的时间。<br>当传输了200G以后，继续进行断点续传，这个时间会有好长一段时间是不更新的（作者认为它在寻找上一次的断点，因为文件大了寻找的时间会久一点），如果你这个时候马上关闭总端，很有可能本次传输就没执行，我就被坑了一次，一觉醒来一点就没传。。。</p>
<h4 id="rsync与scp的差异"><a href="#rsync与scp的差异" class="headerlink" title="rsync与scp的差异"></a>rsync与scp的差异</h4><p>用scp时，这边传多少，另一个服务器就显示文件实时大小<br>而用rsync时，另一个服务器不实时显示文件大小，只有将这边的进程暂时kill掉，才能知道到底传了多少（可能我这个办法比较粗暴）</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill <span class="number">-9</span> <span class="number">175100</span></span><br></pre></td></tr></table></figure>

<h4 id="400G的解压"><a href="#400G的解压" class="headerlink" title="400G的解压"></a>400G的解压</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup tar -xjf ./kod_all.tar.bz2 &gt; /dev/<span class="literal">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br></pre></td></tr></table></figure>
<p>其他查看操作同上面</p>
<h3 id="其他，拆分打包（失败了）"><a href="#其他，拆分打包（失败了）" class="headerlink" title="其他，拆分打包（失败了）"></a>其他，拆分打包（失败了）</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup tar -cjf - kod/ |split -b <span class="number">10000</span>m - kod.tar.bz2. &gt;/dev/<span class="literal">null</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br></pre></td></tr></table></figure>
<p>它会生成</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- <span class="number">1</span> Administrator <span class="number">197121</span>   <span class="number">5242880</span> 十二 <span class="number">27</span> <span class="number">08</span>:<span class="number">39</span> kod.tar.bz2.aa</span><br><span class="line">-rw-r--r-- <span class="number">1</span> Administrator <span class="number">197121</span>   <span class="number">5242880</span> 十二 <span class="number">27</span> <span class="number">08</span>:<span class="number">39</span> kod.tar.bz2.ab</span><br><span class="line">-rw-r--r-- <span class="number">1</span> Administrator <span class="number">197121</span>   <span class="number">5242880</span> 十二 <span class="number">27</span> <span class="number">08</span>:<span class="number">39</span> kod.tar.bz2.ac</span><br><span class="line">-rw-r--r-- <span class="number">1</span> Administrator <span class="number">197121</span>   <span class="number">5242880</span> 十二 <span class="number">27</span> <span class="number">08</span>:<span class="number">39</span> kod.tar.bz2.ad</span><br><span class="line">-rw-r--r-- <span class="number">1</span> Administrator <span class="number">197121</span>   <span class="number">5242880</span> 十二 <span class="number">27</span> <span class="number">08</span>:<span class="number">39</span> kod.tar.bz2.ae</span><br><span class="line">-rw-r--r-- <span class="number">1</span> Administrator <span class="number">197121</span>   <span class="number">5242880</span> 十二 <span class="number">27</span> <span class="number">08</span>:<span class="number">39</span> kod.tar.bz2.af</span><br><span class="line">-rw-r--r-- <span class="number">1</span> Administrator <span class="number">197121</span>   <span class="number">5242880</span> 十二 <span class="number">27</span> <span class="number">08</span>:<span class="number">39</span> kod.tar.bz2.ag</span><br></pre></td></tr></table></figure>
<p>后面默认2位，字符逐渐增加<br>它的解压</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup cat pinkephp.tar.bz2.* <span class="string">| tar -xj &amp;</span></span><br></pre></td></tr></table></figure>

<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://linux.cn/article-7170-1.html">https://linux.cn/article-7170-1.html</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/tdstds/article/details/24870535">http://blog.csdn.net/tdstds/article/details/24870535</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/eroswang/article/details/5555415/">http://blog.csdn.net/eroswang/article/details/5555415/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备13033425号 </a>
      <img src="/images/beianicon.png" style="display: inline-block;">
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hottredpen</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
  <script src='http://image.jk-kj.com/mermaid-8.8.3.min.js'></script>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


















  






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      const visitors = document.querySelector('.leancloud_visitors');
      const url = decodeURI(visitors.id);
      const title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            const counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      const visitors = document.querySelectorAll('.leancloud_visitors');
      const entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            const target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    const { app_id, app_key, server_url } = {"enable":true,"app_id":"nEwTBQU57TgvhE9HufRlxOgK-gzGzoHsz","app_key":"uOHoHWwCwvT2XGKFM33V4RXh","server_url":null,"security":false};
    function fetchData(api_server) {
      const Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    const api_server = app_id.slice(-9) === '-MdYXbMMI' ? `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com` : server_url;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


  

  

</body>
</html>
